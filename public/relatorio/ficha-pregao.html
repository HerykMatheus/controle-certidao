<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Ficha de Fiscalização de Contrato</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 4px;
    }
    h3 {
      text-align: center;
      margin-top: 0;
      font-size: 11px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    td, th {
      border: 1px solid #000;
      padding: 4px;
      vertical-align: top;
    }
    th {
      background-color: #e3dff1;
      text-align: center;
    }
    .section-title {
      background-color: #e3dff1;
      font-weight: bold;
    }
    .assinatura {
      height: 32px;
      border: 1px solid #000;
    }
    .observacoes {
      height: 60px;
      border: 1px solid #000;
    }
    .checkbox-cell {
      text-align: center;
    }
    .info {
      margin-top: 12px;
    }
    .info td {
      border: none;
    }
    .ficha-final {
      display: flex;
      gap: 20px;
      margin-top: 40px;
      font-size: 12px;
    }
    .col-esquerda, .col-direita {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .col-esquerda {
      width: 40%;
    }
    .col-centro {
      width: 20%;
      text-align: center;
    }
    .col-direita {
      width: 40%;
    }
    .linha-bloco, .campo-bloco {
      background-color: #e3dff1;
      padding: 4px;
      font-weight: bold;
      width: 100%;
    }
    .linha-preenchimento input,
    .campo-linha input {
      width: 100%;
      height: 24px;
      border: none;
      border-bottom: 1px solid black;
    }
    .campo-textarea textarea {
      width: 100%;
      height: 100px;
      border: 1px solid black;
      resize: none;
    }
    .espaco {
      height: 16px;
    }
    input[type="text"],
    input[type="date"] {
      border: none;
      outline: none;
      width: 100%;
      font-family: inherit;
      font-size: inherit;
      background-color: transparent;
    }
    textarea {
      border: none;
      outline: none;
      resize: none;
      width: 100%;
      font-family: inherit;
      font-size: inherit;
      background-color: transparent;
      line-height: 1.2;
    }
    th:nth-child(7),
td:nth-child(7) {
  width: 160px; /* ou 180px, ajuste como necessário */
}
    @media print {
  * {
    -webkit-print-color-adjust: exact !important; /* Chrome, Safari */
    print-color-adjust: exact !important;         /* Firefox */
  }
}
  </style>
</head>
<body>
  <h2>Ficha de Fiscalização de Contrato</h2>
  <h3>Art. 117, Lei Nº 14.133/2021</h3>

  <table>
    <tr>
      <td rowspan="2" style="width: 20%; text-align: left;">
        <div><strong>PREGÃO:</strong> <span id="modalidade"></span></div>
        <div><strong>PROCESSO:</strong> __________</div>
        <div><strong>ATA:</strong> __________</div>
      </td>
      <td rowspan="2" style="width: 50%; background-color: #e3dff1; text-align: center; font-weight: bold;">
        <div style="padding-top: 12px;">FORNECEDOR:</div>
        <div id="fornecedor" style="margin-top: 4px; font-weight: normal;"></div>
      </td>
      <td style="width: 30%; background-color: #e3dff1; text-align: center; font-weight: bold;">
        Nº PEDIDO<br><span style="font-size: 10px;">(ORDEM DE FORNECIMENTO)</span>
      </td>
    </tr>
    <tr>
      <td style="text-align: center;"><span id="pedido">__________</span></td>
    </tr>
  </table>

  <table>
    <thead>
      <tr>
        <th>Nº ITEM</th>
        <th>PRODUTO</th>
        <th>MARCA</th>
        <th>QUANTIDADE</th>
        <th>FABRICAÇÃO E LOTE</th>
        <th>VALIDADE</th>
        <th>O ITEM CONFERE COM O DESCRITIVO?</th>
        <th>A QUANTIDADE ENTREGUE É A MESMA DA ORDEM DE FORNECIMENTO?</th>
      </tr>
    </thead>
    <tbody id="tabela-itens">
      <!-- Preenchido por JS -->
    </tbody>
  </table>

<div class="ficha-final">
  <div class="col-esquerda">
    <div>
      <div class="linha-bloco">FISCAL RESPONSÁVEL</div>
      <div class="linha-preenchimento">
        <input type="text" id="fiscal_responsavel" />
      </div>
    </div>

    <div>
      <div class="linha-bloco">LOCAL DE ENTREGA</div>
      <div class="linha-preenchimento">
        <input type="text" id="local" />
      </div>
    </div>

    <div>
      <div class="linha-bloco">PORTARIA DE NOMEAÇÃO FISCAL</div>
      <div class="linha-preenchimento">
        <input type="text" id="portaria" />
      </div>
    </div>

    <div>
      <div class="linha-bloco">DATA DE ENTREGA/ FISCALIZAÇÃO</div>
      <div class="linha-preenchimento">
        <input type="date" id="data_entrega" />
      </div>
    </div>

    <div>
      <div class="linha-bloco">ANOTAÇÃO DA FISCAL</div>
      <div class="campo-textarea">
        <textarea></textarea>
      </div>
    </div>
  </div>

  <div class="col-centro"></div>

  <div class="col-direita">
    <div>
      <div class="campo-bloco">FISCAL DE CONTRATO E CPF</div>
      <div class="campo-linha">
        <input type="text" id="fiscal_contrato" />
      </div>
    </div>

    <div>
      <div class="campo-bloco">GESTOR</div>
      <div class="campo-linha">
        <input type="text" id="gestor_nome" />
      </div>
    </div>

    <div class="espaco"></div>

    <div>
      <div class="campo-bloco">DATA RECEBIMENTO PROVISÓRIO</div>
      <div class="campo-linha">
        <input type="date" id="data_provisorio" />
      </div>
    </div>

    <div>
      <div class="campo-bloco">DATA RECEBIMENTO DEFINITIVO</div>
      <div class="campo-linha">
        <input type="date" id="data_definitivo" />
      </div>
    </div>
  </div>
</div>

 <script>
  const dados = JSON.parse(localStorage.getItem("dadosFicha"));
  if (dados) {
    // Campos principais
    document.getElementById("fornecedor").innerText = dados.fornecedor || "";
    document.getElementById("modalidade").innerText = dados.modalidade || "";
    document.getElementById("pedido").innerText = dados.pedido || "__________";
    document.getElementById("local").value = dados.localEntrega || "";

    // ATA e PROCESSO
    const divs = document.querySelectorAll("td[rowspan='2'] > div");
    divs.forEach((div) => {
      if (div.textContent.includes("PROCESSO")) {
        div.innerHTML = `<strong>PROCESSO:</strong> ${dados.processo || "__________"}`;
      }
      if (div.textContent.includes("ATA")) {
        div.innerHTML = `<strong>ATA:</strong> ${dados.ata || "__________"}`;
      }
    });

    // Buscar fiscal e gestor com base no local de entrega
    let fiscalLocal = "";
    let gestorLocal = "";

    if (Array.isArray(dados.fiscais)) {
      const fg = dados.fiscais.find(fg =>
        fg.local?.trim().toLowerCase() === dados.localEntrega?.trim().toLowerCase()
      ) || dados.fiscais.find(fg => fg.local?.trim().toLowerCase() === "todos");

      fiscalLocal = fg?.fiscal || "";
      gestorLocal = fg?.gestor || "";
    }

    // Preencher campos da ficha
    document.getElementById("fiscal_responsavel").value = fiscalLocal;
    document.getElementById("portaria").value = dados.portaria || "";
    
    document.getElementById("gestor_nome").value = gestorLocal;

    // Datas preenchidas manualmente — deixar em branco
    document.getElementById("data_entrega").value = "";
    document.getElementById("data_provisorio").value = "";
    document.getElementById("data_definitivo").value = "";

    // Preencher itens da tabela
    const tbody = document.getElementById("tabela-itens");
    if (Array.isArray(dados.itens)) {
      dados.itens.forEach((item, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${item.descricao}</td>
          <td><textarea rows="2"></textarea></td>
          <td>${item.quantidade}</td>
          <td><textarea rows="2"></textarea></td>
          <td><textarea rows="2"></textarea></td>
          <td class="checkbox-cell">
            <label><input type="radio" name="confere${idx}" /> SIM</label>
            <label><input type="radio" name="confere${idx}" /> NÃO</label>
          </td>
          <td class="checkbox-cell">
            <label><input type="radio" name="entregue${idx}" /> SIM</label>
            <label><input type="radio" name="entregue${idx}" /> NÃO</label>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
  }
</script>
</body>
</html>
